require "rake/clean"
require_relative "../helper"

CLEAN << "temp"
file "temp" do
    mkdir "temp"
end 

file "temp/TopCoderTest" => %w[temp TopCoderTest.hs dist/include/haskell/TopCoder.hs] do
    sh "ghc -idist/include/haskell -outputdir temp -o temp/TopCoderTest TopCoderTest.hs"
end

namespace :test do
    desc "Test the Haskell library"
    task :haskell => "temp/TopCoderTest" do 
        sh "temp/TopCoderTest"
    end

    desc "Test the plugins's Ruby engine"
    task :engine do 
        ruby "-I../../core/lib -Idist/include/haskell engine_test.rb"
    end
end

desc "Generate solutions for some fixed problems using this plugin"
task :generate => "temp" do
    generate_solutions File.dirname __FILE__
end

desc "Try running the solutions that were generated by rake generate"
task :run => "temp" do
    try_run_solutions File.dirname __FILE__
end